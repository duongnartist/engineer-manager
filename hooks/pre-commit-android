#!/bin/bash
# Pre-commit hook cho Android Team

set -e

echo "ğŸ” Android pre-commit checks..."

# 1. Lint + Format
./gradlew ktlintFormat detekt || {
  echo "âŒ Lint/Detekt failed"
  exit 1
}

# 2. Spelling check (basic - kiá»ƒm tra tÃªn file/class cÃ³ kÃ½ tá»± láº¡)
git diff --cached --name-only | grep -E '\.kt$' | while read file; do
  if grep -nE "[^a-zA-Z0-9_]" "$file" | grep "class "; then
    echo "âŒ Lá»—i Ä‘áº·t tÃªn trong file $file"
    exit 1
  fi
done

# 3. Security check (khÃ´ng commit secret)
if git diff --cached | grep -E "(API_KEY|PASSWORD|SECRET|TOKEN)"; then
  echo "âŒ PhÃ¡t hiá»‡n secret trong code!"
  exit 1
fi

# 4. Commit message check
MSG_FILE=$(git rev-parse --git-dir)/COMMIT_EDITMSG
MSG=$(head -n1 "$MSG_FILE")

if ! [[ $MSG =~ ^\[[A-Z]+-[0-9]+\]\ .+ ]]; then
  echo "âŒ Commit message sai format."
  echo "âœ… Äá»‹nh dáº¡ng Ä‘Ãºng: [ABC-123] Ná»™i dung commit"
  exit 1
fi

echo "âœ… Android pre-commit passed!"